<html lang="en">
  <%- include('../partials/head.ejs') %>

  <body>
    <%- include('../partials/nav.ejs') %>

    <div class="create-space content">
      <h2 align="center">Create a New Space</h2>
      <form id="createSpaceForm" enctype="multipart/form-data">
        <label for="title">Space Title:</label>
        <input type="text" id="title" name="title" required />

        <label for="category">Category</label>
        <select name="category" id="category" required>
          <option value="Study Space">Study Space</option>
          <option value="Recreational">Recreational</option>
          <option value="Professional">Professional</option>
        </select>

        <label for="description">Description:</label>
        <textarea id="description" name="description" required></textarea>

        <label for="photos">Upload a photo:</label>
        <input type="file" id="img" name="img" accept="image/*" />

        <label for="nearestBuilding">Nearest Building:</label>
        <input
          type="text"
          id="nearestBuilding"
          name="nearestBuilding"
          required
        />

        <label for="type">Indoors or Outdoors</label>
        <select name="type" id="type" required>
          <option value="Indoors">Indoors</option>
          <option value="Outdoors">Outdoors</option>
        </select>

        <label for="outlets">Availability of Outlets</label>
        <select name="outlets" id="outlets" multiple required>
          <option value="Plenty">Plenty</option>
          <option value="Many">Many</option>
          <option value="Limited">Limited</option>
          <option value="None">None</option>
        </select>

        <label for="capacity">Capacity</label>
        <select name="capacity" id="capacity" required>
          <option value="1-2">1-2</option>
          <option value="3-5">3-5</option>
          <option value="5-8">5-8</option>
          <option value="10+">10+</option>
        </select>

        <label for="peak">Peak Times</label>
        <select name="peak" id="peak" multiple required>
          <option value="Weekdays">Weekdays</option>
          <option value="Weekends">Weekends</option>
        </select>

        <input type="time" id="time1" name="time1" /> to
        <input type="time" id="time2" name="time2" />

        <button class="submit">Submit</button>
      </form>
    </div>
    <%- include('../partials/footer.ejs') %>

    <script>
      document
        .getElementById("createSpaceForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const form = e.target;
          const formData = new FormData(form);
          const file = formData.get("img");

          if (file) {
            const reader = new FileReader();
            reader.onload = function () {
              formData.set("img", reader.result);

              fetch("/spaces", {
                method: "POST",
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {
                  "Content-Type": "application/json",
                },
              })
                .then((response) => response.json())
                .then((data) => {
                  window.location.href = data.redirect;
                })
                .catch((error) => console.error("Error:", error));
            };
            reader.readAsDataURL(file);
          } else {
            alert("Please select an image.");
          }
        });
    </script>
  </body>
</html>
